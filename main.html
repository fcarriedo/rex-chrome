<html>
  <head>
    <link rel="stylesheet" href="resources/css/rex.css" type="text/css"/>
    <script src='resources/js/jquery.min.js'></script>
    <script src='resources/js/jquery.tmpl.min.js'></script>
    <script src='resources/js/underscore-min.js'></script>
    <script src='resources/js/backbone-min.js'></script>
    <script src='resources/js/rex.js'></script>
    <script>
      $(document).ready( initRex() );

      function login() {
        var usr = $('#usr').val();
        var pswd = $('#pswd').val();

        var authContext = {
          username: usr,
          password: pswd,
          success: function() {
            showFeed();
          },
          error: function() {
            $('#login-err').text('Wrong credentials');
          }
        };

        validateCredentials( authContext );
      }

      function logout() {
        removeCredentials();
        showLoginPage();
      }

      function showLoginPage() {
        $('#feed').hide();
        $('#login').fadeIn();
      }

      function showFeed() {
        $('#login').hide();
        $('#feed').fadeIn();
        fetchGroups(renderGroups);
      }

      function renderGroups( groups ) {
        $('#convore-content').html( $('#groups-tmpl').tmpl(groups) );
      }
    </script>
  </head>
  <body>
    <h2><img src='resources/images/rex.png' title='rex'/> rex</h2>

    <div id='login'>
      <table>
        <tr><td>Username:</td><td><input id='usr' type='text'/></td></tr>
        <tr><td>Password:</td><td><input id='pswd' type='password'/></td></tr>
        <tr><td colspan='2'><button onClick='login()'>Login</button></td></tr>
      </table>
      <div id='login-err'></div>
    </div>

    <div id="feed" style='display: none'>
      <div id='subtitle'>(a Convore extension)</div><br/>
      <div id='convore-content'>Loading...</div>

      <h5><a href='#' onClick='logout()'>logout</a></h5>
    </div>



    <script id='groups-tmpl' type=text/x-jquery-tmpl'>
      <div class='group'>
        <img src='${creator.img}' title='${creator.username}'/>
        <a href='#' onClick='openInConvore("${url}")'>${name}</a>
        <span class='topic'> Topics: ${topics_count} </span>
      </div>
    </script>

    <script>initRex();</script>
  </body>
</html>
